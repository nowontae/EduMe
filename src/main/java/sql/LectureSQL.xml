<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.edume.lecture">
 	<select id="discount"  parameterType="int"  resultType="com.edume.lecture.model.LectureDTO" >
 		select lad.lidx, lad.ladmindiscount, ltd.lteacherdiscount
		from lectureadmindiscount lad, lectureteacherdiscount ltd
		where lad.lidx=#{lidx} and ltd.lidx=#{lidx}
		and <![CDATA[(select sysdate from dual) >= lad.ladminstartdiscount and (select sysdate from dual) <= lad.ladminenddiscount
		and (select sysdate from dual) >= ltd.lteacherstartdiscount and (select sysdate from dual) <= ltd.lteacherenddiscount]]>
 	</select>
 	
 	<!-- 전체 강의 리스트 -->
 	<select id="getAllLectureList" resultType="com.edume.lecture.model.LectureDTO">
 		select *
 		from lecture
 	</select>
 	<!-- 대분류 강의 리스트 -->
 	<select id="getCat1LectureList" parameterType="Map"  resultType="com.edume.lecture.model.LectureDTO">
 		select *
 		from lecture
 		where cat1_idx=#{cat1_idx}
 	</select>
 	<!-- 중분류 강의 리스트 -->
 	<select id="getCat2LectureList" parameterType="Map"  resultType="com.edume.lecture.model.LectureDTO">
 		select *
 		from lecture
 		where cat1_idx=#{cat1_idx} and cat2_idx=#{cat2_idx}
 	</select>
 	<!-- 소분류 강의 리스트 -->
 	<select id="getCat3LectureList" parameterType="Map"  resultType="com.edume.lecture.model.LectureDTO">
 		select *
 		from lecture
 		where cat1_idx=#{cat1_idx} and cat2_idx=#{cat2_idx} and cat3_idx=#{cat3_idx}
 	</select>
 	
 	<select id="getMyLectureList" resultType="com.edume.lecture.model.LectureDTO">
 		select *
 		from lecture l, (select lidx from myLectureList where midx=#{midx}) ml
 		where l.lidx=ml.lidx
 	</select>
 	
 	<select id="getLectureDetail" parameterType="int" resultType="com.edume.lecture.model.LectureDTO">
 		select l.*, m.mname
 		from lecture l, member m
 		where l.lidx=#{lidx} and l.midx = m.midx
 	</select>
 	
 	
 	<select id="getMyClass" parameterType="Map" resultType="com.edume.lecture.model.LectureCurriculumDTO">
 		select *
 		from lectureCurriculum
 		where lidx=#{lidx} and lcsection = #{section} and lcpart = #{part}
 	</select>
 	
 	
 	<select id="getLectureCurriculum" parameterType="int" resultType="com.edume.lecture.model.LectureCurriculumDTO">
 		select *
 		from lectureCurriculum
 		where lidx=#{lidx}
 		order by lcsection, lcpart 
 	</select>
 	
 	<select id="checkMyLecture" parameterType="Map" resultType="Integer">
 		select count(lidx)
 		from mylecturelist
 		where lidx=#{lidx} and midx=#{midx}
 	</select>
 </mapper>